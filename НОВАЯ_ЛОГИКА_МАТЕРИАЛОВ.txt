═══════════════════════════════════════════════════════════════
  💰 ОБНОВЛЕНА ЛОГИКА СПИСАНИЯ МАТЕРИАЛОВ
═══════════════════════════════════════════════════════════════

📅 Дата: 07.11.2025

═══════════════════════════════════════════════════════════════
  🎯 ЧТО ИЗМЕНИЛОСЬ
═══════════════════════════════════════════════════════════════

Теперь при создании подключения с несколькими исполнителями:

┌─────────────────────────────────────────────────────────────┐
│ 1. ЕСЛИ У ОДНОГО ИСПОЛНИТЕЛЯ НЕТ МАТЕРИАЛОВ (баланс = 0)   │
│    → Весь материал списывается с того, у кого есть          │
│    → Автоматически, без дополнительных вопросов             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 2. ЕСЛИ У ОБОИХ ИСПОЛНИТЕЛЕЙ ЕСТЬ МАТЕРИАЛЫ                 │
│    → Система предлагает выбрать, с кого списать             │
│    → Вы выбираете плательщика из списка                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 3. ЕСЛИ НИ У КОГО НЕТ ДОСТАТОЧНО МАТЕРИАЛОВ                 │
│    → Подключение НЕ создаётся                               │
│    → Показывается детальная информация о балансах           │
│    → Нужно добавить материалы через меню                    │
└─────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════
  ⚖️ ВАЖНО: МЕТРАЖ ДЛЯ ЗАРПЛАТЫ
═══════════════════════════════════════════════════════════════

В ОТЧЁТЕ метраж ВСЕГДА делится поровну между всеми 
исполнителями для расчёта зарплаты, НЕЗАВИСИМО от того,
с кого фактически списаны материалы!

Пример:
  Подключение: 120м ВОЛС, 60м ВП
  Исполнители: Иванов, Петров
  Материалы списаны с: Иванов
  
  Фактическое списание:
    Иванов: -120м ВОЛС, -60м ВП
    Петров: 0м
  
  В отчёте (для зарплаты):
    Иванов: 60м ВОЛС, 30м ВП ✓
    Петров: 60м ВОЛС, 30м ВП ✓

═══════════════════════════════════════════════════════════════
  📖 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ
═══════════════════════════════════════════════════════════════

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ СЦЕНАРИЙ 1: Новичок + Опытный                             ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Подключение: 100м ВОЛС, 50м ВП

Исполнители:
  • Опытный: 1000м ВОЛС, 500м ВП
  • Новичок: 0м ВОЛС, 0м ВП

Что происходит:
  ✓ Система видит, что у новичка баланс 0
  ✓ Автоматически списывает с опытного
  ✓ Подключение создаётся сразу

Результат:
  Опытный: -100м ВОЛС, -50м ВП
  В отчёте: каждому по 50м ВОЛС и 25м ВП

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ СЦЕНАРИЙ 2: Два опытных сотрудника                        ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Подключение: 80м ВОЛС, 40м ВП

Исполнители:
  • Сотрудник А: 500м ВОЛС, 300м ВП
  • Сотрудник Б: 400м ВОЛС, 200м ВП

Что происходит:
  ✓ Система видит, что у обоих есть материалы
  ✓ Предлагает выбрать плательщика:
  
    💰 Выбор плательщика материалов
    
    [💰 Сотрудник А (ВОЛС: 500м, ВП: 300м)]
    [💰 Сотрудник Б (ВОЛС: 400м, ВП: 200м)]
  
  ✓ Вы выбираете (например, Сотрудник А)
  ✓ Подключение создаётся

Результат:
  Сотрудник А: -80м ВОЛС, -40м ВП
  Сотрудник Б: без изменений
  В отчёте: каждому по 40м ВОЛС и 20м ВП

┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ СЦЕНАРИЙ 3: Недостаточно материалов                       ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

Подключение: 300м ВОЛС, 150м ВП

Исполнители:
  • Сотрудник А: 200м ВОЛС, 100м ВП
  • Сотрудник Б: 150м ВОЛС, 80м ВП

Что происходит:
  ✗ Система видит, что ни у кого нет 300м ВОЛС
  ✗ Блокирует создание подключения
  ✗ Показывает:
  
    ❌ Недостаточно материалов!
    
    Требуется:
    • ВОЛС: 300 м
    • Витая пара: 150 м
    
    Балансы исполнителей:
    • Сотрудник А: ВОЛС 200м, ВП 100м
    • Сотрудник Б: ВОЛС 150м, ВП 80м
    
    Добавьте материалы через:
    Управление сотрудниками → Управление материалами

Решение:
  → Добавить материалы нужному сотруднику

═══════════════════════════════════════════════════════════════
  🎯 ПРЕИМУЩЕСТВА
═══════════════════════════════════════════════════════════════

✓ Можно работать с новичками без материалов
✓ Контроль - выбор плательщика при наличии материалов
✓ Прозрачность - видно, с кого списаны материалы
✓ Справедливость - зарплата считается поровну

═══════════════════════════════════════════════════════════════
  📝 ЧТО ОСТАЛОСЬ ПРЕЖНИМ
═══════════════════════════════════════════════════════════════

✓ Метраж в отчёте делится поровну для зарплаты
✓ Все исполнители отображаются в отчёте
✓ Фотографии сохраняются как раньше
✓ Отчёты отправляются в канал

═══════════════════════════════════════════════════════════════
  🤖 СТАТУС
═══════════════════════════════════════════════════════════════

✅ Реализовано
✅ Бот работает
✅ Готово к использованию

Подробная документация: MATERIAL_LOGIC_UPDATE.md

═══════════════════════════════════════════════════════════════


